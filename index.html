<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TodoFlow — To‑Do List</title>
  <style>
    :root{
      --bg:#0f172a;        /* slate-900 */
      --panel:#111827;     /* gray-900 */
      --muted:#94a3b8;     /* slate-400 */
      --text:#e5e7eb;      /* gray-200 */
      --accent:#22c55e;    /* green-500 */
      --accent-2:#60a5fa;  /* blue-400 */
      --danger:#ef4444;    /* red-500 */
      --warn:#f59e0b;      /* amber-500 */
      --ok:#10b981;        /* emerald-500 */
      --chip:#1f2937;      /* gray-800 */
      --card:#0b1023;      /* darker panel */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #1e293b 0%, transparent 60%), 
                  radial-gradient(900px 600px at 120% 20%, #111827 0%, transparent 60%),
                  var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    .container{max-width:920px; margin:40px auto; padding:0 16px;}
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom:20px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:40px; height:40px; border-radius:12px;
      background: conic-gradient(from 210deg, var(--accent), var(--accent-2)); 
      box-shadow: 0 10px 30px rgba(34,197,94,.25), inset 0 0 40px rgba(96,165,250,.25);
    }
    h1{font-size: clamp(22px, 3vw, 28px); margin:0; letter-spacing:.3px}
    .muted{color:var(--muted)}
    .controls{display:flex; flex-wrap:wrap; gap:8px}
    .btn{
      background:#0b1224; color:var(--text); border:1px solid #223058;
      padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:600; 
      transition:.2s transform, .2s background, .2s border-color;
    }
    .btn:hover{transform:translateY(-1px); background:#0d1530; border-color:#3351a3}
    .btn.primary{background:linear-gradient(135deg, #1f8e4d, #2bc06b); border-color:transparent}
    .btn.warn{background:#231a05; border-color:#3c2c09; color:#fbbf24}
    .btn.danger{background:#220c0c; border-color:#4c1d1d; color:#fecaca}
    .btn.ghost{background:transparent; border-color:#334155}
    .chip{
      background:var(--chip); color:#cbd5e1; padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid #334155;
    }
    .panel{
      background: linear-gradient(180deg, #0b1023 0%, #0a0e1e 100%);
      border:1px solid #1f2a44; border-radius:18px; padding:16px; box-shadow: 0 12px 30px rgba(2,6,23,.4);
    }
    form.add{
      display:grid; grid-template-columns: 1.2fr .8fr 140px 110px; gap:10px; align-items:center;
    }
    input, select{
      width:100%; padding:12px 12px; border-radius:12px; border:1px solid #233055;
      background:#0b1224; color:var(--text);
      outline:none; transition:.2s border-color, .2s box-shadow;
    }
    input:focus, select:focus{border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    .list{margin-top:14px; display:flex; flex-direction:column; gap:10px}
    .item{
      display:grid; grid-template-columns: 28px 1fr 150px 110px 110px 40px; align-items:center; gap:10px;
      padding:12px; border-radius:14px; background:rgba(10, 16, 36, .7); border:1px solid #1d2846;
      user-select:none;
    }
    .drag{cursor:grab; opacity:.9}
    .checkbox{width:20px; height:20px; border-radius:6px; border:2px solid #334155; display:inline-grid; place-items:center; background:#0b1224}
    .checkbox.checked{background:linear-gradient(135deg, #16a34a, #22c55e); border-color:transparent}
    .title{font-weight:600}
    .title.done{color:#9ca3af; text-decoration:line-through}
    .pill{padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:.3px; text-align:center}
    .p-low{background:#052014; color:#a7f3d0; border:1px solid #065f46}
    .p-med{background:#1a1622; color:#ddd6fe; border:1px solid #6d28d9}
    .p-high{background:#260b0b; color:#fecaca; border:1px solid #ef4444}
    .due{color:#cbd5e1; font-size:12px}
    .overdue{color:#fca5a5}
    .filters{display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:12px}
    .search{flex:1; min-width:200px}
    .empty{padding:28px; text-align:center; color:#94a3b8}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; background:#0b1224; padding:4px 6px; border-radius:6px; border:1px solid #223058; color:#cbd5e1}
    footer{margin-top:24px; display:flex; justify-content:space-between; align-items:center; color:#94a3b8; font-size:13px}
    .hidden{display:none}
    @media (max-width: 860px){
      form.add{grid-template-columns:1fr 1fr 1fr; grid-auto-rows:auto}
      .item{grid-template-columns:28px 1fr 110px 90px 80px 40px}
      .hide-sm{display:none}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>TodoFlow</h1>
          <div class="muted">Fast, keyboard-friendly, and saved offline</div>
        </div>
      </div>
      <div class="controls">
        <button class="btn ghost" id="exportBtn" title="Export tasks to JSON">Export</button>
        <label class="btn ghost" for="importFile" title="Import tasks from JSON">Import</label>
        <input id="importFile" type="file" accept="application/json" class="hidden"/>
        <button class="btn warn" id="clearDoneBtn" title="Remove completed tasks">Clear done</button>
        <button class="btn danger" id="resetBtn" title="Reset all tasks">Reset</button>
      </div>
    </header>

    <section class="panel">
      <form class="add" id="addForm" autocomplete="off">
        <input id="title" placeholder="Add a task, e.g., Draft client report" required/>
        <input id="due" type="date" />
        <select id="priority" title="Priority">
          <option value="med">Medium priority</option>
          <option value="high">High priority</option>
          <option value="low">Low priority</option>
        </select>
        <button class="btn primary" type="submit">Add Task</button>
      </form>

      <div class="filters">
        <div>
          <button class="btn chip" data-filter="all">All</button>
          <button class="btn chip" data-filter="active">Active</button>
          <button class="btn chip" data-filter="done">Completed</button>
        </div>
        <input id="search" class="search" placeholder="Search tasks..."/>
        <div class="chip" id="count">0 items</div>
        <div class="chip hide-sm">Tips: <span class="kbd">N</span> new, <span class="kbd">/</span> search, <span class="kbd">E</span> export</div>
      </div>

      <div id="list" class="list" aria-live="polite"></div>
      <div id="empty" class="empty">No tasks yet. Add your first one above.</div>
    </section>

    <footer>
      <div>Made with ❤️ — your friendly AI dev</div>
      <div id="status"></div>
    </footer>
  </div>

  <script>
    // --- Storage helpers
    const STORAGE_KEY = "todoflow.v1";
    const load = () => JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    const save = (items) => localStorage.setItem(STORAGE_KEY, JSON.stringify(items));

    // --- State
    let items = load();
    let filter = "all";
    let query = "";

    // --- DOM
    const listEl = document.getElementById("list");
    const emptyEl = document.getElementById("empty");
    const addForm = document.getElementById("addForm");
    const titleEl = document.getElementById("title");
    const dueEl = document.getElementById("due");
    const priorityEl = document.getElementById("priority");
    const countEl = document.getElementById("count");
    const searchEl = document.getElementById("search");
    const exportBtn = document.getElementById("exportBtn");
    const importFile = document.getElementById("importFile");
    const clearDoneBtn = document.getElementById("clearDoneBtn");
    const resetBtn = document.getElementById("resetBtn");
    const statusEl = document.getElementById("status");

    // --- Utils
    const uid = () => Math.random().toString(36).slice(2);
    const todayStr = () => new Date().toISOString().slice(0,10);
    const fmtDate = d => d ? new Date(d).toLocaleDateString() : "";
    const isOverdue = d => d && d < todayStr();

    function render(){
      const filtered = items
        .filter(it => filter==="all" ? true : filter==="active" ? !it.done : it.done)
        .filter(it => it.title.toLowerCase().includes(query.toLowerCase()));

      listEl.innerHTML = "";
      filtered.forEach((it, idx) => listEl.appendChild(renderItem(it, idx)));

      emptyEl.style.display = filtered.length ? "none" : "block";
      countEl.textContent = `${items.length} item${items.length!==1?"s":""}`;
      save(items);
    }

    function renderItem(it, idx){
      const row = document.createElement("div");
      row.className = "item drag";
      row.draggable = true;
      row.dataset.id = it.id;

      // drag handlers
      row.addEventListener("dragstart", e => {
        e.dataTransfer.setData("text/plain", it.id);
        row.style.opacity = .5;
      });
      row.addEventListener("dragend", () => row.style.opacity = 1);
      row.addEventListener("dragover", e => e.preventDefault());
      row.addEventListener("drop", (e) => {
        e.preventDefault();
        const from = items.findIndex(x => x.id === e.dataTransfer.getData("text/plain"));
        const to = items.findIndex(x => x.id === it.id);
        if(from>-1 && to>-1 && from !== to){
          const moved = items.splice(from,1)[0];
          items.splice(to,0,moved);
          render();
        }
      });

      const check = document.createElement("div");
      check.className = "checkbox" + (it.done ? " checked" : "");
      check.tabIndex = 0;
      check.role = "checkbox";
      check.addEventListener("click", () => { it.done = !it.done; render(); });

      const title = document.createElement("div");
      title.className = "title" + (it.done ? " done" : "");
      title.contentEditable = true;
      title.spellcheck = true;
      title.textContent = it.title;
      title.addEventListener("blur", () => { it.title = title.textContent.trim() || it.title; render(); });
      title.addEventListener("keydown", (e)=>{
        if(e.key==="Enter"){ e.preventDefault(); title.blur(); }
      });

      const pill = document.createElement("div");
      pill.className = "pill " + (it.priority==="high"?"p-high":it.priority==="low"?"p-low":"p-med");
      pill.textContent = it.priority;

      const due = document.createElement("div");
      due.className = "due" + (isOverdue(it.due) && !it.done ? " overdue" : "");
      due.textContent = it.due ? ("Due " + fmtDate(it.due)) : "No due date";

      const toggleBtn = document.createElement("button");
      toggleBtn.className = "btn";
      toggleBtn.textContent = it.done ? "Mark active" : "Mark done";
      toggleBtn.addEventListener("click", () => { it.done = !it.done; render(); });

      const del = document.createElement("button");
      del.className = "btn danger";
      del.textContent = "Del";
      del.addEventListener("click", () => {
        items = items.filter(x => x.id !== it.id);
        render();
      });

      row.append(check, title, pill, due, toggleBtn, del);
      return row;
    }

    // --- Add
    addForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const title = titleEl.value.trim();
      if(!title) return;
      items.unshift({ id: uid(), title, due: dueEl.value || "", priority: priorityEl.value, done:false });
      titleEl.value = ""; dueEl.value=""; priorityEl.value="med";
      render();
      status("Task added");
    });

    // --- Filters
    document.querySelectorAll("[data-filter]").forEach(btn => {
      btn.addEventListener("click", () => {
        filter = btn.dataset.filter;
        render();
      });
    });

    // --- Search
    searchEl.addEventListener("input", () => { query = searchEl.value; render(); });

    // --- Export / Import
    exportBtn.addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(items, null, 2)], {type:"application/json"});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "todoflow.json";
      link.click();
      status("Exported JSON");
    });
    importFile.addEventListener("change", async (e) => {
      const file = e.target.files[0]; if(!file) return;
      try{
        const text = await file.text();
        const data = JSON.parse(text);
        if(Array.isArray(data)){
          items = data.map(d => ({
            id: d.id || uid(),
            title: String(d.title||"").slice(0,200),
            due: d.due || "",
            priority: ["low","med","high"].includes(d.priority)? d.priority : "med",
            done: !!d.done
          }));
          render();
          status("Imported tasks");
        } else throw new Error("Invalid JSON");
      }catch(err){
        alert("Import failed: " + err.message);
      } finally {
        importFile.value = "";
      }
    });

    // --- Batch actions
    clearDoneBtn.addEventListener("click", () => {
      items = items.filter(x => !x.done);
      render();
      status("Cleared completed");
    });
    resetBtn.addEventListener("click", () => {
      if(confirm("Reset all tasks? This cannot be undone.")){
        items = [];
        render();
        status("Reset complete");
      }
    });

    // --- Keyboard shortcuts
    document.addEventListener("keydown", (e) => {
      if(e.target.closest("input, textarea, [contenteditable='true']")) return;
      if(e.key.toLowerCase() === "n"){ titleEl.focus(); }
      if(e.key === "/"){ e.preventDefault(); searchEl.focus(); }
      if(e.key.toLowerCase() === "e"){ exportBtn.click(); }
    });

    function status(msg){
      statusEl.textContent = msg;
      setTimeout(()=> statusEl.textContent = "", 1500);
    }

    // --- Init
    render();
  </script>
</body>
</html>
